(()=>{"use strict";const e=window.wp.blocks,t=window.React,o=window.wp.blockEditor,r=window.wp.components,n=window.wp.i18n,a=window.wp.element,l=window.wp.data;(0,e.registerBlockType)("blockxpert/ai-product-recommendations",{edit:function({attributes:e,setAttributes:c}){const[i,d]=(0,a.useState)(!1),[s,m]=(0,a.useState)(""),[p,u]=(0,a.useState)([]),[b,_]=(0,a.useState)(null),{title:g,aiEnabled:k,recommendationType:h,layoutStyle:x,productsCount:w,theme:y,showPrice:E,showRating:C,showAddToCart:v,inStockOnly:P,excludeCurrent:f,priceRange:S,customPrompt:T,apiKey:N,model:A,cacheEnabled:I,cacheDuration:R,currentProductId:B,recommendedProducts:O}=e,G=(0,l.useSelect)((e=>e("core/editor")?.getCurrentPostId()||0),[]),F=(0,l.useSelect)((e=>e("core/editor")?.getCurrentPostType()||""),[]);(0,a.useEffect)((()=>{"product"===F&&G&&(setCurrentProductId(G),j(G))}),[G,F]);const j=async e=>{if(window.wp&&window.wp.apiFetch)try{const t=await window.wp.apiFetch({path:`/wc/v3/products/${e}`});_(t)}catch(e){console.error("Error fetching current product:",e)}};(0,a.useEffect)((()=>{window.wp&&window.wp.apiFetch&&D()}),[]);const D=async()=>{try{const e=await window.wp.apiFetch({path:"/wc/v3/products?per_page=8&status=publish"});u(e)}catch(e){console.error("Error fetching products:",e)}},K=async()=>{if(N)if(b||"product"!==F){d(!0);try{const e=await fetch("/wp-json/blockxpert/v1/generate-product-recommendations",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({apiKey:N,model:A,currentProduct:b,recommendationType:h,productsCount:w,customPrompt:T,priceRange:S,inStockOnly:P})});if(e.ok){const t=await e.json();t.success&&t.products?(c({recommendedProducts:t.products}),m((0,n.__)("AI recommendations generated successfully!","blockxpert"))):m((0,n.__)("Failed to generate recommendations. Please check your API key.","blockxpert"))}else m((0,n.__)("Error generating recommendations. Please try again.","blockxpert"))}catch(e){console.error("Error generating recommendations:",e),m((0,n.__)("Error generating recommendations. Please try again.","blockxpert"))}finally{d(!1)}}else alert((0,n.__)("Please wait for the current product to load, then try again.","blockxpert"));else alert((0,n.__)("Please enter your OpenAI API key in the block settings.","blockxpert"))},L=O.length>0?O:p.slice(0,w);return(0,t.createElement)("div",{...(0,o.useBlockProps)({className:`ai-product-recommendations theme-${y}`})},(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(r.PanelBody,{title:(0,n.__)("Recommendation Settings","blockxpert"),initialOpen:!0},(0,t.createElement)(r.TextControl,{label:(0,n.__)("Section Title","blockxpert"),value:g,onChange:e=>c({title:e}),placeholder:(0,n.__)("Enter section title...","blockxpert")}),(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("Enable AI Recommendations","blockxpert"),checked:k,onChange:e=>c({aiEnabled:e})}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Recommendation Type","blockxpert"),value:h,options:[{label:(0,n.__)("Related Products","blockxpert"),value:"related"},{label:(0,n.__)("Cross-Sells","blockxpert"),value:"cross-sell"},{label:(0,n.__)("Upsells","blockxpert"),value:"upsell"},{label:(0,n.__)("Custom","blockxpert"),value:"custom"}],onChange:e=>c({recommendationType:e})}),"custom"===h&&(0,t.createElement)(r.TextControl,{label:(0,n.__)("Custom Prompt","blockxpert"),value:T,onChange:e=>c({customPrompt:e}),placeholder:(0,n.__)('e.g., "gift ideas", "trending items", "best sellers"',"blockxpert")})),(0,t.createElement)(r.PanelBody,{title:(0,n.__)("Display Settings","blockxpert"),initialOpen:!1},(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Layout Style","blockxpert"),value:x,options:[{label:(0,n.__)("Grid","blockxpert"),value:"grid"},{label:(0,n.__)("List","blockxpert"),value:"list"},{label:(0,n.__)("Slider","blockxpert"),value:"slider"}],onChange:e=>c({layoutStyle:e})}),(0,t.createElement)(r.RangeControl,{label:(0,n.__)("Number of Products","blockxpert"),value:w,onChange:e=>c({productsCount:e}),min:1,max:12}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Theme","blockxpert"),value:y,options:[{label:(0,n.__)("Light","blockxpert"),value:"light"},{label:(0,n.__)("Dark","blockxpert"),value:"dark"},{label:(0,n.__)("Minimal","blockxpert"),value:"minimal"}],onChange:e=>c({theme:e})})),(0,t.createElement)(r.PanelBody,{title:(0,n.__)("Product Display","blockxpert"),initialOpen:!1},(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("Show Price","blockxpert"),checked:E,onChange:e=>c({showPrice:e})}),(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("Show Rating","blockxpert"),checked:C,onChange:e=>c({showRating:e})}),(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("Show Add to Cart Button","blockxpert"),checked:v,onChange:e=>c({showAddToCart:e})})),(0,t.createElement)(r.PanelBody,{title:(0,n.__)("AI Settings","blockxpert"),initialOpen:!1},(0,t.createElement)(r.TextControl,{label:(0,n.__)("OpenAI API Key","blockxpert"),value:N,onChange:e=>c({apiKey:e}),type:"password",placeholder:(0,n.__)("Enter your OpenAI API key...","blockxpert")}),(0,t.createElement)(r.SelectControl,{label:(0,n.__)("AI Model","blockxpert"),value:A,options:[{label:"GPT-3.5 Turbo",value:"gpt-3.5-turbo"},{label:"GPT-4",value:"gpt-4"},{label:"GPT-4 Turbo",value:"gpt-4-turbo-preview"}],onChange:e=>c({model:e})}),(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("In Stock Only","blockxpert"),checked:P,onChange:e=>c({inStockOnly:e})}),(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("Exclude Current Product","blockxpert"),checked:f,onChange:e=>c({excludeCurrent:e})}),k&&(0,t.createElement)(r.Button,{isPrimary:!0,onClick:K,isBusy:i,disabled:!N},i?(0,n.__)("Generating...","blockxpert"):(0,n.__)("Generate AI Recommendations","blockxpert")))),(0,t.createElement)("div",{className:"ai-product-recommendations-editor"},(0,t.createElement)("h2",{className:"recommendations-title"},g||(0,n.__)("AI Product Recommendations","blockxpert")),(0,t.createElement)("style",null,"\n                        .ai-product-recommendations-editor .product-price {\n                            font-size: 1.2rem;\n                            font-weight: 600;\n                            color: #007cba;\n                            margin-bottom: 0.5rem;\n                        }\n                        .ai-product-recommendations-editor .woocommerce-Price-amount {\n                            font-weight: 600;\n                        }\n                        .ai-product-recommendations-editor .woocommerce-Price-currencySymbol {\n                            font-weight: normal;\n                        }\n                        .ai-product-recommendations-editor .product-card {\n                            border: 1px solid #e1e5e9;\n                            border-radius: 8px;\n                            overflow: hidden;\n                            transition: all 0.3s ease;\n                            background: #fff;\n                            margin-bottom: 1rem;\n                        }\n                        .ai-product-recommendations-editor .product-image {\n                            position: relative;\n                            overflow: hidden;\n                        }\n                        .ai-product-recommendations-editor .product-thumbnail {\n                            width: 100%;\n                            height: 200px;\n                            object-fit: cover;\n                        }\n                        .ai-product-recommendations-editor .product-info {\n                            padding: 1rem;\n                        }\n                        .ai-product-recommendations-editor .product-title {\n                            margin: 0 0 0.5rem 0;\n                            font-size: 1.1rem;\n                            font-weight: 500;\n                        }\n                        .ai-product-recommendations-editor .product-rating {\n                            margin-bottom: 0.5rem;\n                        }\n                        .ai-product-recommendations-editor .add-to-cart-btn {\n                            width: 100%;\n                            margin-top: 0.5rem;\n                        }\n                        .ai-product-recommendations-editor .products-grid {\n                            display: grid;\n                            gap: 1.5rem;\n                        }\n                        .ai-product-recommendations-editor .products-grid.layout-grid {\n                            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n                        }\n                        .ai-product-recommendations-editor .products-grid.layout-list {\n                            grid-template-columns: 1fr;\n                        }\n                        .ai-product-recommendations-editor .products-grid.layout-slider {\n                            display: flex;\n                            overflow-x: auto;\n                            gap: 1rem;\n                            padding: 1rem 0;\n                        }\n                        .ai-product-recommendations-editor .products-grid.layout-slider .product-card {\n                            flex: 0 0 250px;\n                        }\n                    "),s&&(0,t.createElement)(r.Notice,{status:s.includes("successfully")?"success":"error",onRemove:()=>m("")},s),b&&(0,t.createElement)("div",{className:"current-product-info"},(0,t.createElement)("h4",null,(0,n.__)("Current Product:","blockxpert")),(0,t.createElement)("p",null,b.name),(0,t.createElement)("p",null,(0,n.__)("Type:","blockxpert")," ",(M=h,{related:(0,n.__)("Related Products","blockxpert"),"cross-sell":(0,n.__)("Cross-Sells","blockxpert"),upsell:(0,n.__)("Upsells","blockxpert"),custom:(0,n.__)("Custom Recommendations","blockxpert")}[M]||M))),0===L.length?(0,t.createElement)(r.Placeholder,{icon:"products",label:(0,n.__)("No Products Found","blockxpert"),instructions:(0,n.__)("No products available for recommendations. Add products to your store or generate AI recommendations.","blockxpert")},k&&(0,t.createElement)(r.Button,{isPrimary:!0,onClick:K,isBusy:i,disabled:!N},(0,n.__)("Generate AI Recommendations","blockxpert"))):(0,t.createElement)("div",{className:`recommendations-container layout-${x}`},(0,t.createElement)("div",{className:`products-grid layout-${x}`},L.map(((e,o)=>((e,o)=>{const a="product-card "+("slider"===x?"slider-item":"");return(0,t.createElement)("div",{key:e.id||o,className:a},(0,t.createElement)("div",{className:"product-image"},e.images&&e.images[0]?(0,t.createElement)("img",{src:e.images[0].src,alt:e.name,className:"product-thumbnail"}):(0,t.createElement)("div",{className:"product-placeholder"},(0,n.__)("No Image","blockxpert"))),(0,t.createElement)("div",{className:"product-info"},(0,t.createElement)("h3",{className:"product-title"},e.name),E&&(0,t.createElement)("div",{className:"product-price"},e.price_html?(0,t.createElement)("div",{dangerouslySetInnerHTML:{__html:e.price_html}}):e.price||(0,n.__)("Price not available","blockxpert")),C&&e.average_rating&&(0,t.createElement)("div",{className:"product-rating"},"★".repeat(Math.round(e.average_rating)),(0,t.createElement)("span",{className:"rating-count"},"(",e.review_count,")")),v&&"instock"===e.stock_status&&(0,t.createElement)(r.Button,{isPrimary:!0,className:"add-to-cart-btn"},(0,n.__)("Add to Cart","blockxpert"))))})(e,o)))),k&&(0,t.createElement)("div",{className:"ai-actions"},(0,t.createElement)(r.Button,{onClick:K,isBusy:i,disabled:!N},(0,n.__)("Regenerate AI Recommendations","blockxpert"))))));var M},save:()=>null})})();