(()=>{"use strict";const e=window.wp.blocks,t=window.React,l=window.wp.blockEditor,a=window.wp.components,n=window.wp.i18n,o=window.wp.element;(0,e.registerBlockType)("blockxpert/ai-faq",{edit:function({attributes:e,setAttributes:r}){const[s,c]=(0,o.useState)(!1),[i,u]=(0,o.useState)(""),[p,_]=(0,o.useState)(null),[b,m]=(0,o.useState)(new Set),[d,k]=(0,o.useState)(""),{title:x,aiEnabled:E,maxQuestions:g,autoGenerate:h,showSearch:w,accordionStyle:q,theme:y,questions:C,apiKey:v,model:A}=e,f=()=>{const e={question:"",answer:"",id:Date.now()};r({questions:[...C,e]}),_(e.id)},S=(e,t,l)=>{const a=[...C];a[e]={...a[e],[t]:l},r({questions:a})},P=async()=>{if(v){c(!0);try{const e=await fetch("/wp-json/blockxpert/v1/generate-faq",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({apiKey:v,model:A,maxQuestions:g,context:"Generate relevant FAQ questions and answers for a website"})});if(e.ok){const t=await e.json();t.success&&t.questions?(r({questions:t.questions}),u((0,n.__)("FAQ questions generated successfully!","blockxpert"))):u((0,n.__)("Failed to generate questions. Please check your API key.","blockxpert"))}else u((0,n.__)("Error generating questions. Please try again.","blockxpert"))}catch(e){console.error("Error generating FAQ:",e),u((0,n.__)("Error generating questions. Please try again.","blockxpert"))}finally{c(!1)}}else alert((0,n.__)("Please enter your OpenAI API key in the block settings.","blockxpert"))},Q=C.filter((e=>e.question.toLowerCase().includes(d.toLowerCase())||e.answer.toLowerCase().includes(d.toLowerCase())));return(0,t.createElement)("div",{...(0,l.useBlockProps)({className:`ai-faq-block theme-${y}`})},(0,t.createElement)(l.InspectorControls,null,(0,t.createElement)(a.PanelBody,{title:(0,n.__)("FAQ Settings","blockxpert"),initialOpen:!0},(0,t.createElement)(a.TextControl,{label:(0,n.__)("FAQ Title","blockxpert"),value:x,onChange:e=>r({title:e}),placeholder:(0,n.__)("Enter FAQ title...","blockxpert")}),(0,t.createElement)(a.ToggleControl,{label:(0,n.__)("Enable AI Generation","blockxpert"),checked:E,onChange:e=>r({aiEnabled:e})}),(0,t.createElement)(a.ToggleControl,{label:(0,n.__)("Auto Generate Questions","blockxpert"),checked:h,onChange:e=>r({autoGenerate:e})}),(0,t.createElement)(a.ToggleControl,{label:(0,n.__)("Show Search Bar","blockxpert"),checked:w,onChange:e=>r({showSearch:e})})),(0,t.createElement)(a.PanelBody,{title:(0,n.__)("AI Settings","blockxpert"),initialOpen:!1},(0,t.createElement)(a.TextControl,{label:(0,n.__)("OpenAI API Key","blockxpert"),value:v,onChange:e=>r({apiKey:e}),type:"password",placeholder:(0,n.__)("Enter your OpenAI API key...","blockxpert")}),(0,t.createElement)(a.SelectControl,{label:(0,n.__)("AI Model","blockxpert"),value:A,options:[{label:"GPT-3.5 Turbo",value:"gpt-3.5-turbo"},{label:"GPT-4",value:"gpt-4"},{label:"GPT-4 Turbo",value:"gpt-4-turbo-preview"}],onChange:e=>r({model:e})}),(0,t.createElement)(a.RangeControl,{label:(0,n.__)("Maximum Questions","blockxpert"),value:g,onChange:e=>r({maxQuestions:e}),min:1,max:20}),E&&(0,t.createElement)(a.Button,{isPrimary:!0,onClick:P,isBusy:s,disabled:!v},s?(0,n.__)("Generating...","blockxpert"):(0,n.__)("Generate AI Questions","blockxpert"))),(0,t.createElement)(a.PanelBody,{title:(0,n.__)("Display Settings","blockxpert"),initialOpen:!1},(0,t.createElement)(a.SelectControl,{label:(0,n.__)("Accordion Style","blockxpert"),value:q,options:[{label:(0,n.__)("Expandable","blockxpert"),value:"expandable"},{label:(0,n.__)("Always Open","blockxpert"),value:"always-open"},{label:(0,n.__)("Single Open","blockxpert"),value:"single-open"}],onChange:e=>r({accordionStyle:e})}),(0,t.createElement)(a.SelectControl,{label:(0,n.__)("Theme","blockxpert"),value:y,options:[{label:(0,n.__)("Light","blockxpert"),value:"light"},{label:(0,n.__)("Dark","blockxpert"),value:"dark"},{label:(0,n.__)("Minimal","blockxpert"),value:"minimal"}],onChange:e=>r({theme:e})}))),(0,t.createElement)("div",{className:"ai-faq-editor"},(0,t.createElement)("h2",{className:"faq-title"},x||(0,n.__)("AI FAQ","blockxpert")),i&&(0,t.createElement)(a.Notice,{status:i.includes("successfully")?"success":"error",onRemove:()=>u("")},i),w&&(0,t.createElement)("div",{className:"faq-search"},(0,t.createElement)(a.TextControl,{placeholder:(0,n.__)("Search questions...","blockxpert"),value:d,onChange:k})),0===C.length?(0,t.createElement)(a.Placeholder,{icon:"editor-help",label:(0,n.__)("No FAQ Questions","blockxpert"),instructions:(0,n.__)("Add your first FAQ question or generate AI-powered questions.","blockxpert")},(0,t.createElement)("div",{className:"faq-placeholder-actions"},(0,t.createElement)(a.Button,{isPrimary:!0,onClick:f},(0,n.__)("Add Question","blockxpert")),E&&(0,t.createElement)(a.Button,{onClick:P,isBusy:s,disabled:!v},(0,n.__)("Generate AI Questions","blockxpert")))):(0,t.createElement)("div",{className:"faq-questions"},Q.map(((e,l)=>(0,t.createElement)("div",{key:e.id||l,className:"faq-question"},p===e.id?(0,t.createElement)("div",{className:"faq-edit-form"},(0,t.createElement)(a.TextControl,{label:(0,n.__)("Question","blockxpert"),value:e.question,onChange:e=>S(l,"question",e),placeholder:(0,n.__)("Enter your question...","blockxpert")}),(0,t.createElement)(a.TextareaControl,{label:(0,n.__)("Answer","blockxpert"),value:e.answer,onChange:e=>S(l,"answer",e),placeholder:(0,n.__)("Enter your answer...","blockxpert"),rows:4}),(0,t.createElement)("div",{className:"faq-edit-actions"},(0,t.createElement)(a.Button,{isPrimary:!0,onClick:()=>_(null)},(0,n.__)("Save","blockxpert")),(0,t.createElement)(a.Button,{onClick:()=>{_(null),(e=>{const t=C.filter(((t,l)=>l!==e));r({questions:t})})(l)}},(0,n.__)("Delete","blockxpert")))):(0,t.createElement)("div",{className:"faq-question-content"},(0,t.createElement)("div",{className:"faq-question-header",onClick:()=>(e=>{const t=new Set(b);t.has(e)?t.delete(e):t.add(e),m(t)})(l)},(0,t.createElement)("h3",{className:"faq-question-text"},e.question||(0,n.__)("Untitled Question","blockxpert")),(0,t.createElement)("div",{className:"faq-question-actions"},(0,t.createElement)(a.Button,{isSmall:!0,onClick:t=>{t.stopPropagation(),_(e.id)}},(0,n.__)("Edit","blockxpert")),(0,t.createElement)("span",{className:"faq-toggle-icon"},b.has(l)?"âˆ’":"+"))),b.has(l)&&(0,t.createElement)("div",{className:"faq-answer"},(0,t.createElement)("p",null,e.answer||(0,n.__)("No answer provided.","blockxpert"))))))),(0,t.createElement)("div",{className:"faq-actions"},(0,t.createElement)(a.Button,{isPrimary:!0,onClick:f},(0,n.__)("Add Question","blockxpert")),E&&(0,t.createElement)(a.Button,{onClick:P,isBusy:s,disabled:!v},(0,n.__)("Generate More AI Questions","blockxpert"))))))},save:()=>null})})();